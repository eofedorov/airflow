{
  "doc_key": "kb-2025-09-checklist-prod-deploy",
  "title": "Operational Checklist: Production Deploy (FastAPI + Node services)",
  "doc_type": "checklist",
  "created_at": "2025-09-01",
  "content": "# Purpose\nA short checklist to reduce common production deploy failures across checkout-service, cart-service, search-api, and payment-gateway.\n\n# Before deploy\n- [ ] Confirm current incident status: no ongoing SEV-1/SEV-2.\n- [ ] Check Postgres connections < 70% of max.\n- [ ] Check Redis evictions flat.\n- [ ] Check Elasticsearch health green.\n- [ ] Verify feature flags for rollout are documented in the PR.\n\n# Build and artifacts\n- [ ] GitHub Actions:`ci.yml`green.\n- [ ] Image tag exists in registry and matches commit SHA.\n- [ ] For payment-gateway, confirm Node runtime stays at 18.x (do not auto-bump).\n\n# Database\n- [ ] If schema changes:\n  - [ ] Ensure migration cronjob exists and uses primary Postgres (not PgBouncer).\n  - [ ] Verify alembic head in staging.\n\n# Config and secrets\n- [ ] Secrets present in namespace:\n  -`STRIPE_API_KEY`, `STRIPE_WEBHOOK_SECRET`(payment-gateway)\n- [ ] ConfigMap changes reviewed (timeouts, pool sizes).\n\n# Deploy execution\n- [ ] Deploy to staging first; run smoke tests:\n  -`/health/ready`on all services\n  - Basic checkout flow (start -> pending)\n  - Search query returns results\n- [ ] Promote to prod.\n- [ ] Watch rollout status:\n```bash\nkubectl -n ecommerce-prod rollout status deploy/checkout-service\n```\n\n# After deploy (15 minutes)\n- [ ] Error rate stable (no sustained 5xx).\n- [ ] p95 latency within 20% of baseline.\n- [ ] Stripe webhook success rate stable.\n- [ ] Elasticsearch indexing lag not increasing.\n\n# Edge case notes\n- If enabling new Redis cache behavior, watch`redis_evicted_keys`and cart 409s.\n- If changing search mappings, verify alias`products_read`points to expected index.\n\n# References\n- RB-2025-06 rollout stuck\n- PM-2025-07 migrations caused outage\n",
  "language": "en"
}