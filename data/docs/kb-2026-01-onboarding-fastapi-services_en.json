{
  "doc_key": "kb-2026-01-onboarding-fastapi-services",
  "title": "Onboarding Guide: Working on FastAPI Microservices (checkout-service, cart-service, search-api)",
  "doc_type": "onboarding",
  "created_at": "2026-01-05",
  "content": "# Overview\nThis guide gets you from zero to running our core FastAPI services locally with Docker and a minimal Kubernetes dev setup.\n\n# Repos and services\n- `checkout-service/`(Python 3.11, FastAPI 0.110)\n-`cart-service/`(Python 3.11)\n-`search-api/`(Python 3.11)\n-`infra/`(docker-compose, k8s manifests)\n- Legacy:`payment-gateway/`(Node 18)\n\n# Local prerequisites\n- Docker Desktop 4.27+\n- Python 3.11.7\n- Poetry 1.8+\n- kubectl 1.29+\n\n# Quick start (docker-compose)\nFrom`infra/`:\n```bash\ndocker compose up -d postgres redis elasticsearch\n```\nDefaults:\n- Postgres: `localhost:5432`, db `ecommerce`, user `app`, password `app`\n- Redis: `localhost:6379`\n- Elasticsearch: `localhost:9200`(single-node)\n\n# Running checkout-service\n```bash\ncd checkout-service\npoetry install\nexport DATABASE_URL=postgresql+psycopg://app:app@localhost:5432/ecommerce\nexport REDIS_URL=redis://localhost:6379/0\npoetry run uvicorn app.main:app --reload --port 8081\n```\nHealth endpoints:\n-`/health/live`\n- `/health/ready`\n\nCommon startup errors:\n- Missing env var:\n  - `pydantic_core._pydantic_core.ValidationError: Settings.STRIPE_API_KEY Field required`\n- Wrong DB URL:\n  - `psycopg.OperationalError: connection failed: Connection refused`\n\n# DB migrations\nWe use Alembic.\n```bash\ncd checkout-service\npoetry run alembic upgrade head\n```\nRule: migrations run against **primary Postgres**, not PgBouncer.\n\n# Running cart-service\n```bash\ncd cart-service\npoetry install\nexport CART_CACHE_TTL_SECONDS=900\npoetry run uvicorn app.main:app --reload --port 8082\n```\nEdge case: if Redis is down and `READINESS_STRICT_DEPS=true`, readiness fails. For local dev, set `READINESS_STRICT_DEPS=false`.\n\n# Running search-api\n```bash\ncd search-api\npoetry install\nexport ELASTICSEARCH_URL=http://localhost:9200\npoetry run uvicorn app.main:app --reload --port 8083\n```\nIf you see:\n- `failed to find field`errors: your local ES index mapping is stale. Recreate:\n```bash\ncurl -X DELETE http://localhost:9200/products-v3-local\npython scripts/create_index.py\n```\n\n# Testing\n- Unit tests:`poetry run pytest -q`\n- Integration tests require docker-compose dependencies.\n\n# Internal conventions\n- Service names in logs: `service=<name> env=<env> commit=<sha>`\n- Error responses:\n  - JSON: `{ 'error_code': '...', 'message': '...' }`\n- Timeouts:\n  - All outbound calls must set connect + read timeouts.\n\n# Debugging tips\n- Use `X-Request-Id`header; services propagate it.\n- For DB issues, check`application_name` in Postgres (`checkout-service@local`).\n- For Redis cache behavior, set `LOG_CACHE_KEYS=true`in cart-service (do not enable in prod).\n\n# Next steps\n- Read runbooks: RB-2026-02 Redis evictions, RB-2026-01 Stripe webhook backlog\n- Read ADRs: ADR-2025-03 Redis cart cache, ADR-2024-12 Stripe webhooks\n",
  "language": "en"
}