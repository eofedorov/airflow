{
  "doc_key": "kb-2025-05-api-search-api",
  "title": "API Spec: search-api Public API (v3) for Product Search",
  "doc_type": "api_spec",
  "created_at": "2025-05-28",
  "content": "# Overview\nsearch-api provides product search backed by Elasticsearch. It exposes a stable query interface even as index mappings evolve (see ADR-2025-02).\n\nBase URL: `/api/search`\nAuth: optional for anonymous search; required for personalized boosts.\n\n# Endpoint\n## GET /api/search/products\nQuery params:\n- `q`(string)\n-`page`(int, default 1)\n-`page_size`(int, default 24, max 100)\n-`filters`(repeatable, e.g.,`brand:acme`)\n- `sort` (`relevance|price_asc|price_desc`)\n\nResponse 200:\n```json\n{\n  \"total\": 1234,\n  \"page\": 1,\n  \"page_size\": 24,\n  \"results\": [{\"sku\": \"SKU-123\", \"title\": \"...\", \"price_minor\": 1299}]\n}\n```\n\nErrors:\n- 400: `{ 'error_code': 'INVALID_FILTER' }`\n- 503: `{ 'error_code': 'SEARCH_UNAVAILABLE' }`\n\n# Timeouts and retries\n- search-api sets ES request timeout 150ms.\n- Retries are disabled to avoid amplifying load.\n\n# Edge cases\n- `q`empty: returns trending products (cached for 60s).\n- If ES returns 429`es_rejected_execution_exception`, search-api returns 503 with `retry_after_seconds: 2`.\n- If index alias missing (misconfig), error:\n  - `index_not_found_exception: no such index [products_read]`\n\n# Operational notes\n- Read alias: `products_read`\n- If cluster health is red, enable degraded mode:\n  - `SEARCH_ENABLE_AGGS=false`\n\n# Related docs\n- Runbook: RB-2025-10 ES cluster red\n- Postmortem: PM-2025-12 ES disk watermark incident\n",
  "language": "en"
}